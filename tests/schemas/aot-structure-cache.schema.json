{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "D365 AOT Structure Cache Schema",
  "description": "Schema for validating the generated AOT structure cache file containing D365 object types with metadata",
  "type": "object",
  "required": ["metadata", "categories"],
  "properties": {
    "metadata": {
      "type": "object",
      "description": "Cache generation metadata and statistics",
      "required": ["generatedAt", "totalTypes", "categorizedTypes", "uncategorizedTypes", "categorizationRate", "generationTimeMs"],
      "properties": {
        "generatedAt": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 timestamp when cache was generated"
        },
        "totalTypes": {
          "type": "integer",
          "minimum": 0,
          "description": "Total number of D365 object types discovered"
        },
        "categorizedTypes": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of types successfully categorized"
        },
        "uncategorizedTypes": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of types that could not be categorized"
        },
        "categorizationRate": {
          "type": "string",
          "pattern": "^\\d+\\.\\d+%$",
          "description": "Percentage of types successfully categorized (e.g., '90.2%')"
        },
        "generationTimeMs": {
          "type": "integer",
          "minimum": 0,
          "description": "Time taken to generate the cache in milliseconds"
        }
      }
    },
    "categories": {
      "type": "object",
      "description": "D365 object types organized by functional categories",
      "patternProperties": {
        "^.*$": {
          "$ref": "#/definitions/category"
        }
      },
      "additionalProperties": false
    }
  },
  "definitions": {
    "category": {
      "type": "object",
      "description": "A functional category containing related D365 object types",
      "required": ["categoryName", "description", "icon", "folderPattern", "types"],
      "properties": {
        "categoryName": {
          "type": "string",
          "description": "Display name of the category"
        },
        "description": {
          "type": "string",
          "description": "Detailed description of the category's purpose"
        },
        "icon": {
          "type": "string",
          "pattern": "\\.(ico|png|svg)$",
          "description": "Icon file name for the category"
        },
        "folderPattern": {
          "type": "string",
          "description": "Folder pattern used to organize objects of this category"
        },
        "types": {
          "type": "array",
          "description": "Array of D365 object types in this category",
          "items": {
            "$ref": "#/definitions/d365ObjectType"
          }
        }
      }
    },
    "d365ObjectType": {
      "type": "object",
      "description": "A D365 object type with metadata from assembly reflection",
      "required": ["Name", "FullName", "Namespace", "IsClass", "IsEnum", "IsInterface", "Properties", "matchedPattern", "d365Metadata"],
      "properties": {
        "Name": {
          "type": "string",
          "pattern": "^Ax[A-Z]",
          "description": "Short name of the D365 object type (e.g., 'AxTable')"
        },
        "FullName": {
          "type": "string",
          "description": "Fully qualified name including namespace"
        },
        "Namespace": {
          "type": "string",
          "description": "Namespace of the type"
        },
        "IsClass": {
          "type": "boolean",
          "description": "Whether this type is a class"
        },
        "IsEnum": {
          "type": "boolean",
          "description": "Whether this type is an enumeration"
        },
        "IsInterface": {
          "type": "boolean",
          "description": "Whether this type is an interface"
        },
        "BaseType": {
          "type": ["string", "null"],
          "description": "Name of the base type, if any"
        },
        "Properties": {
          "type": "array",
          "description": "Properties available on this type",
          "items": {
            "$ref": "#/definitions/typeProperty"
          }
        },
        "matchedPattern": {
          "type": "string",
          "description": "Regex pattern that was used to categorize this type"
        },
        "d365Metadata": {
          "type": "object",
          "description": "D365-specific metadata extracted from properties",
          "additionalProperties": {
            "$ref": "#/definitions/metadataProperty"
          }
        }
      }
    },
    "typeProperty": {
      "type": "object",
      "description": "A property of a D365 object type",
      "required": ["Name", "Type", "FullType", "CanWrite", "IsStatic", "IsEnum", "EnumValues"],
      "properties": {
        "Name": {
          "type": "string",
          "description": "Property name"
        },
        "Type": {
          "type": "string",
          "description": "Short type name"
        },
        "FullType": {
          "type": "string",
          "description": "Fully qualified type name"
        },
        "CanWrite": {
          "type": "boolean",
          "description": "Whether the property can be written to"
        },
        "IsStatic": {
          "type": "boolean",
          "description": "Whether the property is static"
        },
        "IsEnum": {
          "type": "boolean",
          "description": "Whether the property type is an enumeration"
        },
        "EnumValues": {
          "type": "array",
          "description": "Possible values if property type is an enum",
          "items": {
            "type": "string"
          }
        }
      }
    },
    "metadataProperty": {
      "type": "object",
      "description": "D365-specific metadata property with type information",
      "required": ["type", "fullType", "canWrite", "isStatic", "isEnum", "enumValues"],
      "properties": {
        "type": {
          "type": "string",
          "description": "Short type name of the metadata property"
        },
        "fullType": {
          "type": "string",
          "description": "Fully qualified type name of the metadata property"
        },
        "canWrite": {
          "type": "boolean",
          "description": "Whether the metadata property can be written to"
        },
        "isStatic": {
          "type": "boolean",
          "description": "Whether the metadata property is static"
        },
        "isEnum": {
          "type": "boolean",
          "description": "Whether the metadata property type is an enumeration"
        },
        "enumValues": {
          "type": "array",
          "description": "Possible values if metadata property type is an enum",
          "items": {
            "type": "string"
          }
        },
        "value": {
          "description": "Static value of the property, if applicable"
        }
      }
    }
  }
}
